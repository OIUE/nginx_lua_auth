env JWT_KEY;
env REDIS_HOST;
env REDIS_PORT;


worker_processes auto;
worker_rlimit_nofile 65535;
error_log logs/error.log debug;

events {
	multi_accept on;
	worker_connections 65535;
}

http {
   lua_socket_log_errors off;
   # lua_package_path "/usr/local/openresty/luajit/lib/?.lua;;";
   lua_package_path "/usr/local/openresty/lualib/resty/?.lua;;";

   server {
      listen 80;
      server_name *.local;

      location / {
         set $linkapi_subscriber '';
         set $linkapi_tenant '';
         access_by_lua_file /etc/nginx/lua/access.lua;
         proxy_pass http://web_api;
         proxy_set_header X-Linkapi-Subscriber $linkapi_subscriber;
         proxy_set_header X-Linkapi-Tenant $linkapi_tenant;
         proxy_pass_request_headers on;
      }

      location /token {
         access_by_lua_file /etc/nginx/lua/token.lua;
         proxy_pass http://web_api;
      }
   }

   # uncomment to setup all files inside conf.d folder
   # include /etc/nginx/conf.d/*.conf;
}